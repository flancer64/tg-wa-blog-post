# Bootstrap Contract

Path: `./ctx/docs/code/bootstrap.md`

## Назначение

Документ фиксирует инженерный контракт bootstrap-запуска Telegram Translation Publisher. Уровень определяет форму composition root, правила инициализации DI-контейнера и границы ответственности bootstrap без перехода к прикладной логике.

## Общая форма

Bootstrap представляет собой единственный исполняемый entrypoint backend-приложения и запускается напрямую через Node.js.

Файл bootstrap обязан содержать shebang:

```bash
#!/usr/bin/env node
```

## Структура проекта

- Исходный код размещается в каталоге `src/`.
- Используются исключительно ESM-модули с расширением `.mjs`.

## Dependency Injection

Bootstrap является единственным composition root системы.

В bootstrap:

- создаётся экземпляр `@teqfw/di` Container;
- настраиваются namespace roots;
- запрещено использование `container.register` (допускается только в тестах).

Namespace-модель:

```txt
Ttp_Back_  → src/
Teqfw_Di_  → node_modules/@teqfw/di/src
```

DI-контейнер не экспортируется и не доступен вне bootstrap.

## Получение зависимостей

Bootstrap получает через контейнер:

- `Ttp_Back_App$`;
- сервис логирования.

Bootstrap не выполняет прикладной логики и не участвует в репликационном цикле.

## CLI аргументы

Bootstrap обязан:

- передавать в `App.run()` массив `process.argv.slice(2)`;
- не интерпретировать и не разбирать CLI-аргументы;
- не вводить маршрутизацию или диспетчеризацию команд.

## Обработка выполнения

Bootstrap:

- вызывает `app.run({ projectRoot, cliArgs })`;
- ожидает возврата `exitCode`;
- завершает процесс с этим кодом.

Ответственность за корректное формирование `exitCode` лежит на `App`.

## Логирование ошибок

Bootstrap может использовать сервис логирования для фиксации исключений, возникающих на этапе получения зависимостей или вызова `run()`. Логирование не должно содержать секретов и токенов.

## Минимализм

Bootstrap обязан оставаться минимальным и не допускает:

- pre-init бизнес-логики;
- telemetry;
- profiling;
- расширяемых режимов запуска;
- альтернативных entrypoint-моделей.

## Итог

Bootstrap Telegram Translation Publisher является минимальным composition root, отвечающим исключительно за инициализацию DI-контейнера, получение `App`, передачу CLI-аргументов и завершение процесса с корректным кодом. Он не содержит прикладной логики и не вводит дополнительные режимы исполнения.
