# Configuration Contract

Path: `./ctx/docs/code/configuration.md`

## Назначение

Документ фиксирует поведение конфигурационного слоя Telegram Translation Publisher. Уровень определяет модель загрузки, инициализации и использования конфигурации без повторного описания её структуры.

## Общая модель

Конфигурация состоит из двух компонентов:

- `ConfigurationLoader`;
- `Configuration`.

`ConfigurationLoader` отвечает за:

- чтение переменных окружения через `node:process`;
- загрузку `.env` (при наличии);
- формирование объекта конфигурации в соответствии со структурой;
- выбрасывание исключения при отсутствии обязательных полей.

`Configuration` представляет собой immutable-объект, используемый прикладным кодом.

## Работа с `.env`

Загрузка `.env` выполняется вручную внутри `ConfigurationLoader`.

Bootstrap не передаёт готовое окружение и не участвует в загрузке конфигурации.

Использование внешних библиотек для загрузки `.env` не предполагается.

## Ошибка конфигурации

Если отсутствует любое обязательное поле:

- `ConfigurationLoader` выбрасывает исключение;
- агрегат не формируется;
- `App` перехватывает исключение и завершает выполнение с `exitCode = 1`;
- ошибка логируется.

## DI-модель

`ConfigurationLoader` является singleton (`$`).

`Configuration` является singleton (`$`).

В рамках одного запуска допускается создание только одного экземпляра конфигурации.

## Доступ к окружению

Только `ConfigurationLoader` имеет право работать с `node:process`.

Остальной код не должен обращаться к `process.env` напрямую.

## Логирование

Конфигурационный слой логирует только ошибки.

Информация о загруженных значениях или ключах не логируется.

## Модель источника данных

Конфигурация жёстко ограничена env-моделью.

Поддержка:

- профилей;
- альтернативных источников конфигурации;
- JSON-файлов;

не предусматривается.

## Итог

Конфигурационный слой Telegram Translation Publisher централизует загрузку параметров из окружения, изолирует прикладной код от `process.env`, использует immutable-объект конфигурации и завершает выполнение при отсутствии обязательных значений.
