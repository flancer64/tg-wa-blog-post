# Prompt Loading Contract

Path: `./ctx/docs/code/configuration/prompt.md`

## Назначение

Документ фиксирует инженерный контракт загрузки системных prompt для перевода в Telegram Translation Publisher. Уровень определяет источник prompt, правила fallback и границы ответственности компонентов без описания процедур реализации.

## Общая модель

Системный prompt является внешним текстовым артефактом, используемым при обращении к LLM API. Prompt не входит в доменную модель агрегата и не влияет на его идентичность.

Загрузка prompt осуществляется отдельным DI-компонентом (`PromptProvider`). Другие компоненты не взаимодействуют с файловой системой напрямую.

## Источник prompt

Для каждого целевого языка используется отдельный файл:

```txt
var/prompt/translate_en.md
var/prompt/translate_es.md
```

Путь трактуется относительно `projectRoot`, переданного в прикладной слой.

Файлы рассматриваются как текст UTF-8 без BOM.

## Fallback-модель

Если соответствующий файл:

- отсутствует;
- недоступен для чтения;
- пуст;

используется встроенное значение prompt по умолчанию.

Fallback не рассматривается как ошибка выполнения и не влияет на `status` агрегата.

## Разделение ответственности

`PromptProvider`:

- выполняет чтение файлов;
- реализует fallback;
- возвращает итоговый текст prompt.

`RunCycle`:

- запрашивает готовый prompt;
- не знает о файловой структуре;
- не реализует fallback-логику.

`LlmTranslator`:

- принимает готовый prompt;
- не читает файловую систему;
- не формирует prompt самостоятельно.

## Инварианты

- Prompt не сохраняется в агрегате.
- Prompt не влияет на идентичность публикации.
- Изменение содержимого файла влияет только на последующие run-cycle.
- Отсутствие файлов не блокирует работу системы.

## Ограничения

- Поддерживаются только языки, предусмотренные продуктовой моделью (`en`, `es`).
- Динамическое добавление языков не входит в текущий контракт.
- Использование внешних библиотек конфигурации для загрузки prompt не предполагается.

## Итог

Prompt Loading Contract определяет файловую модель хранения системных prompt с обязательной fallback-логикой и строгим разделением ответственности между компонентами. Prompt остаётся внешним текстовым артефактом и не влияет на доменную структуру агрегата.
