# Aggregate Contract

Path: `./ctx/docs/code/aggregate.md`

## Назначение

Документ фиксирует кодовой контракт агрегата Telegram Translation Publisher: момент формирования, состав, неизменяемость и связь со storage-слоем.

## Общая модель

Агрегат является финальной фиксацией run-cycle и формируется отдельным компонентом после завершения веток en и es.

## Момент формирования

Агрегат создаётся только после получения `ru_message_id` и завершения веток публикации для en и es. При отсутствии `ru_message_id` агрегат не создаётся.

## Обязательные поля

Агрегат обязан содержать поля, согласованные с архитектурной моделью:

- `ru_message_id`
- `ru_original_text`
- `ru_published_at`
- `en_text`
- `en_message_id`
- `en_published_at`
- `es_text`
- `es_message_id`
- `es_published_at`
- `status` (`success` или `failure`)

## Правило статуса

`status` вычисляется бинарно по итогам run-cycle: `success` только при успешной публикации в обоих целевых каналах; любой иной итог фиксируется как `failure`.

## Неизменяемость

После формирования агрегат не изменяется. Перезапись, дозапись и пост-фактум корректировка агрегата запрещены.

## Связь со storage

Агрегат формируется как доменный объект без метаданных файловой адресации. Имя файла, временный файл и атомарная фиксация относятся к ответственности storage-слоя.

## Идемпотентность

Если агрегат для `ru_message_id` уже существует, новый агрегат не формируется и run-cycle завершается без побочных действий.

## Итог

Агрегат Telegram Translation Publisher является неизменяемой бинарно-классифицированной фиксацией факта обработки одной ru-публикации и сохраняет единый контракт полей для всех уровней документации.
