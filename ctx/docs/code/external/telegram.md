# Telegram Adapter Contract

Path: `./ctx/docs/code/external/telegram.md`

## Назначение

Документ фиксирует контракт внешнего взаимодействия с Telegram Bot API в Telegram Translation Publisher. Уровень определяет ответственность адаптеров, их поведение при ошибках и границы логики.

## Разделение ответственности

Telegram-интеграция разделяется на два отдельных компонента:

- `TelegramReader` — чтение последнего сообщения из ru-канала;
- `TelegramPublisher` — публикация сообщений в en и es каналы.

Компоненты изолированы друг от друга и не совмещают функции чтения и публикации.

## TelegramReader

`TelegramReader`:

- запрашивает последнее сообщение из ru-канала;
- не выполняет фильтрацию по storage;
- возвращает объект, содержащий:
  - `message_id`;
  - `text`;
  - дату сообщения.

Адаптер возвращает данные в том виде, в котором они получены, без семантической валидации содержимого.

Если сообщение:

- не текстовое;
- пустое;
- содержит медиа;

адаптер возвращает найденные данные без дополнительной обработки.

## TelegramPublisher

`TelegramPublisher`:

- публикует текстовое сообщение в указанный канал;
- возвращает полный объект ответа Telegram;
- не выполняет пост-обработку ответа.

`message_id` опубликованных сообщений сохраняется в агрегате.

## Retry

Адаптер допускает retry при сетевых ошибках или ошибках API.

Максимальное количество попыток — 3.

Retry реализуется внутри адаптера и не влияет на внешний контракт.

## Исключения

При неуспешном взаимодействии адаптер может выбрасывать исключения.

Возврат Result-объектов не требуется.

## Логирование

Адаптер логирует:

- вызовы API;
- ошибки;
- HTTP-статусы;
- тела ответов при ошибках.

Логирование не должно содержать секретов.

## Данные агрегата

В агрегате сохраняются:

- `message_id` опубликованных сообщений;
- результат публикации (успех или failure).

HTTP-статусы и тела ошибок не сохраняются в агрегате и предназначены только для логирования.

## Ограничения формата

Поддерживается только текстовая публикация.

Медиа-контент не поддерживается.

Разметка (например, markdown или HTML) допускается как часть текста, без специальной обработки адаптером.

## Расширяемость

Telegram-интеграция остаётся тонким адаптером поверх HTTP API. Логика преобразования данных должна выноситься в отдельные компоненты при необходимости.

## Итог

Telegram Adapter Telegram Translation Publisher реализует минимальную, изолированную и тестируемую модель взаимодействия с Telegram Bot API, разделяя чтение и публикацию, допуская ограниченный retry и сохраняя в агрегате только фактические результаты публикации.
