# LLM Adapter Contract

Path: `./ctx/docs/code/external/llm.md`

## Назначение

Документ фиксирует контракт взаимодействия с LLM API в Telegram Translation Publisher. Уровень определяет ответственность адаптера, его поведение при ошибках и границы функциональности.

## Общая модель

В системе используется один универсальный компонент:

```txt
LlmTranslator
```

Компонент отвечает исключительно за перевод текста на указанный язык.

Использование LLM для иных задач не допускается.

## Контракт метода

Метод перевода принимает:

- исходный текст;
- целевой язык (`en` или `es`);
- сформированный prompt (передаётся извне).

Адаптер не отвечает за генерацию prompt и не читает файлы из `/var/prompt/`.

Метод возвращает полный ответ LLM API без редактирования.

## Retry

Адаптер допускает retry при сетевых или API-ошибках.

Максимальное количество попыток — 3.

Retry реализуется внутри адаптера и не влияет на внешний контракт.

## Исключения

При неуспешном взаимодействии адаптер может выбрасывать исключения.

Возврат `null` или Result-объектов не требуется.

## Логирование

Адаптер логирует:

- факт обращения к LLM;
- ошибки;
- полный ответ LLM API;
- stack trace при исключениях.

Секреты (API-ключи) не логируются.

## Данные агрегата

В агрегате сохраняются:

- итоговый переведённый текст;
- не секретные метаданные LLM (при наличии).

Секретные данные и технические детали API не сохраняются в агрегате.

## Ограничения

LLM-адаптер:

- не занимается обработкой prompt;
- не выполняет пост-обработку текста;
- не изменяет структуру ответа LLM;
- не реализует провайдер-независимую абстракцию.

Смена LLM-провайдера в рамках текущего продукта не предполагается.

## Итог

LLM Adapter Telegram Translation Publisher представляет собой минимальный компонент перевода, принимающий готовый prompt и возвращающий полный ответ LLM API, допускающий ограниченный retry и не выходящий за рамки задачи перевода текста.
