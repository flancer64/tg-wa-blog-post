# Logging Contract

Path: `./ctx/docs/code/logging.md`

## Назначение

Документ фиксирует правила логирования в Telegram Translation Publisher.

## Общая модель

Логирование осуществляется исключительно через отдельный `Logger`-сервис, внедряемый через DI.

Прямое использование:

- `console.log`
- `console.error`
- любых других методов `console`

запрещено во всём коде, включая bootstrap.

## Уровни логирования

Поддерживаются уровни:

- `info`
- `warn`
- `error`
- `debug`
- `exception`

Наличие уровней не управляется CLI и не зависит от аргументов запуска.

## Независимость от бизнес-логики

Логирование не влияет на:

- статус агрегата;
- `exitCode`;
- порядок фаз выполнения.

Ошибка `Logger` не приводит к failure прикладного цикла.

## Формат логов

Логи выводятся в текстовом формате.

Каждая запись обязана содержать timestamp.

## Содержание логов

Допускается логирование:

- `ru_message_id`;
- `chat_id`;
- текста сообщений;
- переведённого текста;
- полного тела ответа LLM;
- полного тела ответа Telegram при ошибках;
- stack trace исключений.

## Секреты

Запрещено логирование:

- `TELEGRAM_TOKEN`;
- `LLM_API_KEY`.

Если секреты попали в текст исключения или внешний ответ, `Logger` обязан выполнять маскирование перед записью.

## Идемпотентный случай

Если агрегат уже существует, это логируется на уровне `info`.

## Итог

Логирование Telegram Translation Publisher является централизованным механизмом наблюдаемости. Оно не влияет на прикладную логику и не участвует в формировании статуса агрегата.
