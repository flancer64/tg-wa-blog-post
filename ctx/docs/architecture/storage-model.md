# Модель файлового хранения

Path: `./ctx/docs/architecture/storage-model.md`

## Назначение уровня

Документ фиксирует архитектурную модель файлового хранения Telegram Translation Publisher. Уровень определяет принципы адресации агрегатов, свойства источника истины и инварианты записи без привязки к конкретным форматам сериализации и без описания процедур реализации.

## Роль хранилища

Файловая структура является единственным источником истины для факта обработки сообщений и одновременно выполняет роль архива результатов. Система не предусматривает восстановление состояния из Telegram и не содержит модели реконструкции архива.

Проверка «сообщение уже обрабатывалось» выполняется исключительно по наличию соответствующего агрегата в файловом хранилище.

## Единица хранения

Единицей хранения является агрегат публикации. Один агрегат соответствует одному физическому объекту хранения. Перезапись агрегата запрещена. Удаление агрегата не является частью штатной эксплуатации.

## Адресация и именование

Каждый агрегат сохраняется в виде одного файла. Имя файла включает два компонента: эксплуатационный временной маркер фиксации и `ru_message_id`. Временной компонент используется как элемент адресации и упорядочивания архива. `ru_message_id` используется как доменная идентичность агрегата.

## Атомарность фиксации

Агрегат фиксируется одним атомарным актом записи. Архитектурная модель не допускает частичной фиксации или последовательного дописывания отдельных частей агрегата. Запись осуществляется только в финальном виде, отражающем итог выполнения репликационного цикла.

## Версионность

Версионность агрегатов не вводится. Один агрегат является единственной финальной фиксацией результата обработки без хранения истории изменений.

## Человекочитаемость

Хранилище должно сохранять возможность ручного просмотра человеком. Это свойство относится к архитектурным требованиям к представлению данных и не определяет конкретный формат файла на уровне данного документа.

## Итог

Модель хранения Telegram Translation Publisher основана на файлах агрегатов, адресуемых по времени фиксации и `ru_message_id`, с атомарной записью финального состояния, без индексации, без версий и без сценариев восстановления, при сохранении человекочитаемости архива.
