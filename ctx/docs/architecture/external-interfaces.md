# Внешние интерфейсы системы

Path: `./ctx/docs/architecture/external-interfaces.md`

## Назначение уровня

Документ фиксирует архитектурные границы Telegram Translation Publisher по отношению к внешним системам и внешним текстовым артефактам. Уровень описывает допустимые операции и контракты взаимодействия без привязки к конкретным библиотекам, форматам HTTP-запросов или техническим деталям реализации.

## Общая модель внешнего взаимодействия

Система взаимодействует с двумя внешними API и одним внешним текстовым источником:

- Telegram Bot API — получение и публикация сообщений;
- LLM API — языковое преобразование;
- файловые prompt-артефакты — текстовые инструкции для LLM.

Все перечисленные элементы являются внешними по отношению к доменной модели и не входят во внутреннюю структуру агрегата.

---

## Интерфейс Telegram Bot API

### Назначение

Telegram Bot API используется для чтения исходного сообщения из ru-канала и публикации производных сообщений в en и es каналах.

### Допустимые операции

В рамках архитектурной модели допускаются следующие классы операций:

- получение последнего сообщения из ru-канала;
- публикация текстового сообщения в en-канал;
- публикация текстового сообщения в es-канал.

Редактирование, удаление сообщений, обработка медиа-контента и подписка на события не входят в архитектурную модель.

### Модель входных данных

Получаемое сообщение рассматривается как атомарная текстовая публикация и включает:

- `message_id`;
- текст сообщения с форматированием;
- эксплуатационные атрибуты публикации.

Медиа и вложения не входят в поддерживаемую модель.

### Модель выходных данных

Результатом публикации является текстовое сообщение и его `message_id`, используемые для фиксации агрегата.

---

## Интерфейс LLM API

### Назначение

LLM API используется для языкового и культурного преобразования исходного текста ru в целевой язык (en или es) при сохранении смыслового ядра.

### Контракт преобразования

Входом в LLM API является:

- исходный текст ru;
- системный prompt, соответствующий целевому языку.

Выходом является текст перевода. Дополнительные структурные объекты доменной модели не формируются.

LLM API рассматривается как преобразователь «текст → текст» в рамках одного запроса. Пакетные запросы нескольких языков в одном вызове не предполагаются.

### Ограничения взаимодействия

- для каждого языка выполняется отдельный вызов;
- повторный вызов для одного языка в рамках одного run-cycle не допускается;
- prompt не входит в доменную модель агрегата.

---

## Модель prompt-артефактов

Системный prompt относится к внешнему текстовому артефакту и не является частью агрегата публикации.

Архитектурная модель допускает:

- хранение prompt в файловой структуре проекта;
- языковую раздельность prompt (en и es);
- использование встроенного значения по умолчанию при отсутствии соответствующего файла.

Отсутствие prompt-файла не изменяет доменную модель и не влияет на структуру агрегата. Prompt используется исключительно как входной параметр взаимодействия с LLM API.

Prompt-артефакты не версионируют агрегаты и не участвуют в идентичности публикации.

---

## Граница ответственности

Telegram Bot API отвечает за доставку и публикацию сообщений. LLM API отвечает за текстовое преобразование. Файловые prompt-артефакты предоставляют текстовые инструкции для LLM и не влияют на доменную структуру агрегата.

Система не переносит внутренние механизмы внешних API и файловых источников в доменную модель и не формирует зависимостей от их внутреннего устройства.

---

## Итог

Внешние интерфейсы Telegram Translation Publisher ограничены чтением и публикацией текстовых сообщений через Telegram Bot API, текстовыми преобразованиями через LLM API и использованием внешних prompt-артефактов. Взаимодействие описывается на уровне декларативных контрактов «сообщение → сообщение» и «текст → текст» без расширения функциональной области системы.
