# Доменная модель публикации

Path: `./ctx/docs/architecture/domain-model.md`

## Назначение уровня

Документ фиксирует доменную модель агрегата публикации в рамках архитектурной формы Telegram Translation Publisher. Уровень определяет идентичность агрегата, его состав, правила целостности и неизменяемости без перехода к вопросам композиции, формата хранения или реализации.

## Агрегат публикации

Базовой структурной единицей системы является агрегат публикации. Один агрегат соответствует одной публикации в ru-канале и отражает полный результат её репликации в en и es каналы.

Агрегат создаётся только при обнаружении нового сообщения в ru-канале и соответствует ровно одному запуску CLI.

## Идентичность агрегата

Первичным идентификатором агрегата является `ru_message_id`. Уникальность `ru_message_id` гарантируется в пределах ru-канала и используется как доменная идентичность агрегата. Дополнительный внутренний идентификатор не вводится.

## Состав агрегата

Агрегат включает следующие обязательные атрибуты:

- `ru_message_id`
- `ru_original_text`
- `ru_published_at`
- `en_text`
- `en_message_id`
- `en_published_at`
- `es_text`
- `es_message_id`
- `es_published_at`
- `status`

Временные поля относятся к эксплуатационным атрибутам и не участвуют в определении доменной корректности. Поле `status` фиксирует итог выполнения репликационного цикла как часть выходного состояния.

`status` выражает бинарный итог репликации: успешный или неуспешный. Частичный успех не формирует отдельного состояния и относится к неуспешному итогу. Значение `status` является финальным атрибутом агрегата и не изменяется после фиксации.

## Целостность агрегата

Агрегат считается структурно корректным только при наличии всех предусмотренных атрибутов. Структура агрегата остаётся полной вне зависимости от результата репликации. При неуспешном результате значения атрибутов, относящихся к неуспешной части репликации, фиксируются внутри агрегата как часть финального состояния.

Один агрегат соответствует максимум одному сообщению en и одному сообщению es. Дополнительные репликации для одного `ru_message_id` не допускаются.

## Неизменяемость

После фиксации агрегат является неизменяемым. Дозапись и корректировка агрегата не допускаются.

## Связь публикаций

Связь между ru, en и es публикациями инкапсулирована внутри агрегата. Отдельные внешние ссылки или обратные зависимости не формируют дополнительной доменной структуры.

## Временная модель

Временные атрибуты относятся к эксплуатационным характеристикам и не влияют на правила идентичности, целостности или валидности агрегата. Время запуска CLI не является частью доменной модели.

## Итог

Доменная модель Telegram Translation Publisher основана на единственном агрегате публикации, идентифицируемом `ru_message_id`, включающем полный набор текстов, идентификаторов и эксплуатационных атрибутов и обладающем свойством полной неизменяемости после фиксации.
