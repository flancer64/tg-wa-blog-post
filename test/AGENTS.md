# Runtime Context for Test Zone (`./test/`)

Path: `./test/AGENTS.md`

## Назначение

Каталог `test/` содержит исполняемые тестовые сценарии и подчиняется нормативной модели, зафиксированной в `ctx/docs/code/testing.md`.

Тестовая зона предназначена исключительно для проверки production-кода и не является частью прикладного поведения системы.

## Структура зоны

Каталог `test/` разделён на два нормативных подкаталога:

- `unit/` — изолированное тестирование без side effects;
- `dev/` — интеграционная проверка фрагментов системы с допустимыми side effects.

Каждая зона использует собственный composition root:

- `unit/unit-bootstrap.mjs`
- `dev/dev-bootstrap.mjs`

Production bootstrap в тестовой зоне не используется. В системе существует ровно один production composition root.

Структура каталогов внутри `unit/` и `dev/` зеркальна структуре `src/`.

## Инварианты test-зоны

В тестовой зоне:

- не модифицируется production-контракт;
- не расширяется CLI-модель;
- не создаётся альтернативный режим исполнения приложения;
- не переносится бизнес-логика из `src/` в `test/`;
- не используется test-зона для обхода архитектурных ограничений.

Тесты вызывают production-компоненты, но не изменяют архитектурные инварианты системы.

## Unit-зона

- Обязательна строгая DI-изоляция.
- Используется `enableTestMode()`.
- Все внешние зависимости подменяются.
- Реальные сетевые, файловые и API-вызовы запрещены.
- Каждый тест создаёт собственный DI-контейнер.

Unit-тесты детерминированы и идемпотентны.

## Dev-зона

- Используется `enableTestMode()`.
- Допускаются реальные вызовы LLM API и Telegram API.
- Допускаются файловые операции и запись в `./var/data`.
- Допускаются side effects.
- Допускается частичная подмена зависимостей.

Dev-тесты могут быть недетерминированными и зависеть от состояния внешнего окружения.

## Импорты и DI

Статические импорты project-кода разрешены только внутри файлов `*.test.mjs`.

Во всех остальных случаях применяется DI-модель, зафиксированная в `ctx/docs/code/di.md`.

## Инструменты выполнения

Тесты выполняются через:

- `node:test`
- `node:assert/strict`

Использование сторонних тестовых фреймворков не допускается.

## Итог

`test/AGENTS.md` фиксирует runtime-инварианты тестовой зоны, разделяя unit и dev тестирование, сохраняя единственный production composition root и неизменность архитектурных и продуктовых инвариантов системы.
