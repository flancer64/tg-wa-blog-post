# Source Code — AGENTS

Path: `./src/AGENTS.md`

## Статус документа

Документ устанавливает обязательный процедурный контракт для агента при работе с production-кодом в каталоге `src/`.

Документ не описывает архитектуру, продукт или инженерные инварианты. Он определяет допустимость изменений.

---

## 1. Предусловие изменений

Перед любым изменением кода агент обязан загрузить нормативные документы кодового уровня из `ctx/docs/code/`, включая:

- `conventions.md`
- `di.md`
- `logging.md`
- `testing.md`
- `error-handling.md`

Изменения без учёта этих документов недопустимы.

---

## 2. Ограничение области

В каталоге `src/` агент:

- изменяет только production-код;
- не вводит альтернативный bootstrap;
- не изменяет DI-модель;
- не вводит альтернативные механизмы логирования;
- не расширяет scope продукта без явного указания человека.

---

## 3. Декларации типов

При добавлении нового класса агент обязан:

- добавить декларацию в `types.d.ts`;
- указать корректный путь к файлу;
- обеспечить соответствие DI-namespace.

Отсутствие обновления `types.d.ts` делает изменение незавершённым.

---

## 4. Тестирование

Любое изменение production-кода требует:

- наличия unit-теста для каждого нового модуля (кроме entrypoint);
- успешного выполнения unit-тестов;
- фиксации результата тестирования.

Dev-тесты не заменяют unit-тесты.

---

## 5. Поведение при ошибках тестирования

При падении unit-тестов агент обязан:

- не считать задачу завершённой;
- исправить код и повторно запустить тесты
  или
- передать проблему человеку с явной фиксацией причины.

Изменения при падающих unit-тестах недопустимы.

---

## 6. Запрещено

В `src/` запрещено:

- вносить изменения без загрузки нормативного контекста;
- использовать `container` внутри бизнес-классов;
- обходить DI через статические импорты project-кода;
- использовать `console.*`;
- завершать задачу при падающих тестах.

---

## 7. Критерий валидности

Изменение production-кода считается валидным только если:

- нормативы кодового уровня соблюдены;
- `types.d.ts` обновлён при необходимости;
- unit-тесты выполнены успешно;
- результат тестирования зафиксирован.

Несоблюдение любого пункта делает изменение некорректным.
